var dialogOn = false;

function dialog_window() {
    document.body.innerHTML += `
        <div id="dialog" class="dialog">
            <div class="label" onclick="openDialog()">Нажми, чтобы спросить!</div>
            <div class="header">История:</div>
            <div class="history" id="history"></div>
            <div class="question">
                <input id="Qdialog" placeholder="Введите вопрос"/>
                <br>
                <button onclick="ask('Qdialog')">Спросить</button>
            </div>
        </div>
    `;
}
       
       var knowledge = [
        ["Упругие свойства твердых тел", "описывают", "способность восстанавливать форму после деформации"],
    ["Изучение упругих свойств", "позволяет", "определить пределы, при которых материал сохраняет свою структуру"],
    ["Твердые тела", "обладают", "жесткостью при изгибе"],
    ["Твердые тела", "обладают", "модулем Юнга "],
    ["Материал", "сохраняет", "свою структуру"],
    ["Жесткость при изгибе", "это", "способность материала сопротивляться изгибу"],
    ["Метод изгиба", "измеряет", "прогиб древесного бруска при нагрузке"],
    ["Основным параметром", "является", "жесткость материала"],
    ["Жесткость древесины", "измеряется", "с помощью экспериментальной установки"],
    ["Брусок", "устанавливается", "на опоры"],
    ["Сила", "передается", "через чашку с грузом"],
    ["Метод изгиба", "применяют", "с измерением прогиба при нагрузке"],
    ["Изгибающая сила", "равна", "половине силы тяжести груза"],
    ["Прогиб древесины", "измеряется", "с помощью индикатора"],
    ["Все твердые тела", "изменяют", "размеры под действием сил"],
    ["Все твердые тела", "изменяют", "форму под действием сил"],
    ["Тело", "восстанавливает", "форму после прекращения действия сил"],
    ["Деформация", "называется упругой ", "при малой длительности воздействия"],
    ["Пластические деформации", "сохраняются", "после снятия нагрузки"],
    ["Упругие деформации", "используются", "в амортизационных устройствах"],
    ["Внутренние силы", "препятствуют", "деформации тела"],
    ["Силы упругости", "уравновешивают", "внешние силы"],
    ["Напряжение", "это", "отношение силы к площади поверхности"],
    ["Изгибающая сила", "равна", "P = m * g / 2"],
    ["Модуль Юнга", "определяется", "через жесткость материала"],
    ["Длина изгибаемой части", "равна", "l = L / 2"],
    ["Напряжение", "называется", "отношением силы к площади поверхности"],
    ["Коэффициент Пуассона", "определяется", "соотношением изменения диаметра к длине"],
    ["Деформация растяжения", "характеризуется", "абсолютным удлинением Δl"],
    ["Изменение длины стержня", "сопровождается", "изменением его поперечных размеров"],
    ["Материалы с отрицательным коэффициентом Пуассона", "называются", "ауксетиками"],
    ["Деформация сдвига", "характеризуется", "смещением плоских слоев тела"],
    ["Жесткость при сдвиге", "зависит", "от размеров тела"],
   ["Жесткость при сдвиге", "зависит", "от упругих свойств тела"],
    ["При упругих деформациях", "выполняется", "закон Гука"],
    ["Модуль Юнга", "измеряется", "в паскалях"],
    ["Модуль сдвига", "равен", "тангенциальному напряжению при угле 45°"],
    ["Опоры", "удерживают", "брусок по краям"],
    ["Опоры", "выполнены из ", "металлических элементов"],
    ["Индикатор", "измеряет", "прогиб бруска в миллиметрах"],
    ["Индикатор", "установлен", "на середине испытуемого бруска"],
  ["Индикатор", "измеряет", "деформацию образца"],
  ["Металлическая труба", "проходит через", "опоры"],
  ["Металлическая труба", "предотвращает", "боковые смещения образца"],
  ["Металлическая труба", "служит", "осью, на которой располагается индикатор прогиба"],
    ["Сила тяжести", "создаёт", "изгибающий момент на середине бруска"],
    ["Сила тяжести", "вызывает", "деформацию"],
   ["Грузовая система", "представляет", "чашку"],
    ["Брусок", "является", "прямоугольной планкой из древесины"],
    ["Изучение упругих свойств древесины", "важно", "для расчёта нагрузочных характеристик"],
    ["Жесткость", "обеспечивают", "надёжность конструкций из дерева"],
    ["Модуль Юнга", "обеспечивают", "надёжность конструкций из дерева"],
    ["Экспериментальная установка", "позволяет определить", "модуль Юнга"],
    ["Экспериментальная установка", "позволяет определить", "жесткость древесины"],
    ["Нагрузка", "передается", "на середину бруска"],
    ["Нагрузка", "передается", "через чашку с грузом"],
    ["Индикатор", "фиксирует", "величину прогиба λ"],
    ["Прогиб λ", "является", "основой для расчета характеристик"],
    ["Закон Гука", "связывает", "деформирующую силу и деформацию"],
    ["Изгибающая сила", "определяется", "половиной веса груза"],
    ["Деформация", "бывает", "растяжением"],
    ["Деформация", "бывает", "изгибом"],
    ["Деформация", "бывает", "сжатием"],
    ["Деформация", "бывает", "сдвигом "],
    ["Жесткость бруса", "вычисляется", "по закону Гука"],
    ["Жесткость бруса", "вычисляется", "при изгибе"],
    ["Упругие свойства", "используются", "в измерительных приборах"],
    ["Коэффициент жесткости", "определяется", "размерами материала"],
    ["Коэффициент жесткости", "определяется", "свойствами материала"],
    ["Пластические деформации", "основаны", "на обработке металлов"],
    ["Амортизационные устройства", "работают", "на упругих деформациях"],
    ["Внутренние силы", "возникают", "при деформации тела"],
    ["Тангенциальное напряжение", "равно", "касательному напряжению на поверхности"],
   ["Деформация", "зависит", "от приложенной силы"],
    ["Материалы", "подразделяются", "на упругие и пластические"],
    ["Модуль сдвига", "определяется", "через напряжение и угол сдвига"],
    ["Поперечные размеры", "изменяются", "при растяжении стержня"],
    ["Угол сдвига", "измеряется", "в радианах"],
    ["Коэффициент жесткости", "зависит", "от формы и размеров тела"],
    ["Амортизационные устройства", "используют", "упругие свойства материалов"],
    ["Индикатор", "показывает", "максимальный прогиб"],
    ["Грузовая система", "создает", "изгибающий момент"],
    ["Сила тяжести", "вычисляется", "по массе груза и ускорению свободного падения"],
    ["Прямоугольный брусок", "является", "стандартным образцом"],
    ["Модуль Юнга", "позволяет рассчитать", "упругость материала"],
    ["Напряжение", "возникает", "при приложении внешней силы"],
    ["Сила упругости", "уравновешивает", "внешнюю силу"],
    ["Пластические деформации", "используются", "в обработке металлов"],
    ["Упругие материалы", "восстанавливают", "свою форму"],
    ["Ауксетики", "увеличиваются", "в поперечном сечении при растяжении"],
    ["Жесткость", "характеризует", "способность сопротивляться деформациям"],
    ["Формула", "описывает", "связь между силой и прогибом"],
    ["Тангенциальное напряжение", "зависит", "от касательной силы"],
    ["Деформация изгиба", "приводит", "к нарушению прямолинейности оси бруса"],
    ["Коэффициент Пуассона", "характеризует", "соотношение поперечной и продольной деформации"],
    ["Внешние силы", "вызывают", "деформацию тела"],
    ["Упругие свойства материалов", "используются", "в строительстве и инженерии"],
    ["Амортизаторы", "работают", "на основе упругих свойств"],
    ["Прогиб", "зависит", "от силы и жёсткости материала"],
    ["масса груза", "передаётся", "через чашку"],
    ["Сила упругости", "возникает", "при смещении частиц"],
    ["Деформация", "бывает", "упругой и пластической"],
    ["Напряжение", "определяется", "как отношение силы к площади"],
    ["Индикатор", "измеряет", "вертикальное смещение"],
    ["Труба", "обеспечивает", "соосность конструкции"],
    ["Брусок", "опирается", "на металлические опоры"],
    ["Формула Юнга", "выражает", "упругие характеристики материала"],
    ["Сила давления", "создаёт", "деформацию в центре бруска"],
    ["Материалы", "характеризуются", "разными значениями модуля Юнга"],
    ["Предел упругости", "зависит", "от структуры материала"],
    ["Изгиб", "используется", "для определения жёсткости"],
    ["Жёсткость", "определяется", "по прогибу"],
    ["Схема установки","выглядит","D:/5 сем/кмс/устанвока.jpg"]
        ];

        var endings = [
            ["ет", "(ет|ут|ют)"],  ["ёт", "(ёт|ут|ют)"], ["ут", "(ет|ут|ют)"], ["ют", "(ет|ут|ют)"],
            ["ит", "(ит|ат|ят)"], ["ат", "(ит|ат|ят)"], ["ят", "(ит|ат|ят)"],
            ["ется", "(ет|ут|ют)ся"], ["ётся", "(ёт|ут|ют)ся"], ["утся", "(ет|ут|ют)ся"], ["ются", "(ет|ут|ют)ся"],
            ["ится", "(ит|ат|ят)ся"], ["атся", "(ит|ат|ят)ся"], ["ятся", "(ит|ат|ят)ся"],
            ["ен", "ен"], ["ена", "ена"], ["ено", "ено"], ["ены", "ены"], ["ивает", "ивает"],
            ["ан", "ан"], ["ана", "ана"], ["ано", "ано"], ["аны", "аны"],
            ["жен", "жен"], ["жна", "жна"], ["жно", "жно"], ["жны", "жны"],
            ["это", "это"], ["такое", "это"],  ["равна", "равна"], ["равно", "равно"], ["равен", "равен"], 
            ["составляет", "составляет"], ["служит", "слудит"], ["создаёт", "создавать"]
        ];
        
        

        // Вопросные слова для распознавания запросов
var questionWords = ["чему", "сколько", "каково", "Через что","чем"];
       // Вспомогательная функция: проверка окончания слова
function getEnding(word) {
    for (var j = 0; j < endings.length; j++) {
        if (word.endsWith(endings[j][0])) {
            return j;
        }
    }
    return -1;
}

// Преобразование первой буквы в заглавную
function capitalize(str) {
    return str.charAt(0).toUpperCase() + str.slice(1);
}

// Обработка вопроса
function processQuestion(question) {
    return question
        .split(' ')
        .map(word => word.toLowerCase())
        .join(' ');
}

function getAnswer(question) {
    var result = false;
    var exactAnswer = null;
    var answers = [];

    // Подготовка вопроса
    var words = question.toLowerCase().split(' ');

    // Проверка уточняющих вопросов
    var isUnitQuestion = words.includes("в") || words.includes("на");

    // Анализ вопроса
    for (var i = 0; i < words.length; i++) {
        var endingIndex = getEnding(words[i]);
        if (endingIndex >= 0) {
            var predicatePattern = endings[endingIndex][1];
            var predicate = new RegExp(predicatePattern, "i");

            // Создание шаблона для подлежащего
            var subjectPattern = words.slice(i + 1).join(".*");
            var subject = new RegExp(".*" + subjectPattern + ".*", "i");

            // Поиск совпадений в базе знаний
            for (var j = 0; j < knowledge.length; j++) {
                if (
                    predicate.test(knowledge[j][1]) &&
                    (subject.test(knowledge[j][0]) || subject.test(knowledge[j][2]))
                ) {
                    const answer = knowledge[j][2];
                      // Если ответ - картинка, создаём HTML для изображения
                      if (answer.match(/\.(jpg|jpeg|png|gif)$/i)) {
                        return `<img src="${answer}" alt="Изображение" style="max-width: 100%; height: auto;" onclick="zoom('${answer}')">`;
                    }
                    var potentialAnswer = capitalize(
                        knowledge[j][0] +
                        " " +
                        knowledge[j][1] +
                        " " +
                        knowledge[j][2] +
                        "."
                    );

                    // Для уточняющих вопросов (например, "В чем")
                    if (isUnitQuestion && words.includes("в")) {
                        if (knowledge[j][2].toLowerCase().includes("в")) {
                            exactAnswer = potentialAnswer;
                        }
                    }

                    // Проверка на точное совпадение
                    if (
                        knowledge[j][1].toLowerCase() === words[i] &&
                        knowledge[j][0].toLowerCase() === words.slice(0, i).join(" ")
                    ) {
                        exactAnswer = potentialAnswer;
                    }

                    answers.push(potentialAnswer);
                    result = true;
                }
            }
        }
    }

    // Если есть точный ответ, возвращаем его
    if (exactAnswer) {
        return exactAnswer;
    }

    // Возвращаем только первый релевантный ответ
    return result ? answers[0] : "Ответ не найден.";
}




       function openDialog() {
    if (dialogOn) {
        document.getElementById("dialog").style.marginLeft = "-30px";
        dialogOn = false;
    } else {
        document.getElementById("dialog").style.marginLeft = "-1250px";
        dialogOn = true;
    }
}

        
        function hide() {
            document.getElementById("zoomDiv").style.display = 'none';
        }
        
        function zoom(imageSrc) {
            document.getElementById("zoomImage").src = imageSrc;
            document.getElementById("zoomDiv").style.display = 'block';
        }
        
        function startDialog() {
            var question = document.getElementById("question").value;
            var response = getAnswer(question);
            document.getElementById("response").innerHTML = response;
        }
        function ask(questionInput) {
            var question = document.getElementById(questionInput).value;
            dialogOn = true;
        
            // Создание блока с вопросом
            var newDiv = document.createElement("div");
            newDiv.className = 'question';
            newDiv.innerHTML = question;
            document.getElementById("history").appendChild(newDiv);
        
            // Создание блока с ответом
            var answerDiv = document.createElement("div");
            answerDiv.className = 'answer';
            answerDiv.innerHTML = getAnswer(question);
            document.getElementById("history").appendChild(answerDiv);
        
            // Прокрутка истории вниз
            document.getElementById("history").scrollTop = document.getElementById("history").scrollHeight;
        
            // Очистка поля ввода
            document.getElementById(questionInput).value = "";
        }
        


        
        const questions = [
            "Какие свойства описывают способность восстанавливать форму после деформации?",
            "Что описывает способность восстанавливать форму после деформации?",
            "Что позволяет изучение упругих свойств?",
            "Чем обладают твердые тела?",
            "Что сохраняет свою структуру?",
            "Что такое жесткость при изгибе?",
            "Что измеряет метод изгиба?",
            "Чем является жесткость материала?",
            "С помощью чего измеряется жесткость древесины?",
            "Где устанавливается брусок?",
            "Через что передается сила?",
            "Как применяют метод изгиба?",
            "Чему равна изгибающая сила?",
            "С помощью чего измеряется прогиб древесины?",
            "Что изменяют все твердые тела под действием сил?",
            "Какие деформации сохраняются после снятия нагрузки?",
            "Где используются упругие деформации?",
            "Что препятствует деформации тела?",
            "Какие силы уравновешивают внешние силы?",
            "Что такое напряжение?",
            "Чему равна изгибающая сила?",
            "Через что определяется модуль Юнга?",
            "Чему равна длина изгибаемой части?",
            "Как называется напряжение?",
            "Как определяется коэффициент Пуассона?",
            "Чем характеризуется деформация растяжения?",
            "Чем сопровождается изменение длины стержня?",
            "Как называются материалы с отрицательным коэффициентом Пуассона?",
            "Чем характеризуется деформация сдвига?",
            "От чего зависит жесткость при сдвиге?",
            "От чего зависит жесткость?",
            "Что описывают упругие свойства твердых тел?",
            "Что выполняется при упругих деформациях?",
            "В чем измеряется модуль Юнга?",
            "Чему равен модуль сдвига?",
            "Что удерживают опоры?",
            "Из чего выполнены опоры?",
            "Что измеряет индикатор?",
            "Где установлен?",
            "Через что проходит металлическая труба?",
            "Что предотвращает металлическая труба?",
            "Что создаёт сила тяжести?",
            "Что вызывает сила тяжести?",
            "Что представляет грузовая система?",
            "Чем является брусок?",
            "Для чего важно изучение упругих свойств древесины?",
            "Что обеспечивает жесткость?",
            "Что фиксирует индикатор?",
            "Чем является прогиб λ?",
            "Как определяется изгибающая сила?",
            "Какими бывают деформации?",
            "Как вычисляется жесткость бруса?",
            "Где используются упругие свойства?",
            "Чем определяется коэффициент жесткости?",
            "На чём основаны пластические деформации?",
            "На чём работают амортизационные устройства?",
            "Когда возникают внутренние силы?",
            "Чему равно тангенциальное напряжение?",
            "От чего зависит деформация?",
            "На какие виды подразделяются материалы?",
            "Через что определяется модуль сдвига?",
            "Что описывают упругие свойства твердых тел?",
            "Что изменяется при растяжении стержня?",
            "В каких единицах измеряется угол сдвига?",
            "От чего зависит коэффициент жесткости?",
            "Что используют амортизационные устройства?",
            "Что показывает индикатор?",
            "Как вычисляется сила тяжести?",
            "Чем является прямоугольный брусок?",
            "Когда возникает напряжение?",
            "Что уравновешивает сила упругости?",
            "Где используются пластические деформации?",
            "Что восстанавливают упругие материалы?",
            "Что характеризует жесткость?",
            "Что описывает формула?",
            "От чего зависит тангенциальное напряжение?",
            "К чему приводит деформация изгиба?",
            "Как определяется коэффициент Пуассона?",
            "Что вызывают внешние силы?",
            "Где используются упругие свойства материалов?",
            "На основе чего работают амортизаторы?",
            "От чего зависит прогиб?",
            "Через что передаётся масса груза?",
            "Когда возникает сила упругости?",
            "Какими бывают деформации?",
            "Как определяется напряжение?",
            "Что измеряет индикатор?",
            "Что обеспечивает труба?",
            "На что опирается брусок?",
            "Что выражает формула Юнга?",
            "Что создаёт сила давления?",
            "Чем характеризуются материалы?",
            "От чего зависит предел упругости?",
            "Для чего используется изгиб?"
        ];

      